(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function n(e,n,t){var o,i=e.getWrapperElement();return o=i.appendChild(document.createElement("div")),o.className=t?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof n?o.innerHTML=n:o.appendChild(n),o}function t(e,n){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=n}e.defineExtension("openDialog",function(o,i,r){function s(e){if("string"==typeof e)c.value=e;else{if(f)return;f=!0,u.parentNode.removeChild(u),a.focus(),r.onClose&&r.onClose(u)}}var c,l;r||(r={}),t(this,null);var u=n(this,o,r.bottom),f=!1,a=this;return(c=u.getElementsByTagName("input")[0])?(c.focus(),r.value&&(c.value=r.value,!1!==r.selectValueOnOpen&&c.select()),r.onInput&&e.on(c,"input",function(e){r.onInput(e,c.value,s)}),r.onKeyUp&&e.on(c,"keyup",function(e){r.onKeyUp(e,c.value,s)}),e.on(c,"keydown",function(n){r&&r.onKeyDown&&r.onKeyDown(n,c.value,s)||((27==n.keyCode||!1!==r.closeOnEnter&&13==n.keyCode)&&(c.blur(),e.e_stop(n),s()),13==n.keyCode&&i(c.value,n))}),!1!==r.closeOnBlur&&e.on(c,"blur",s)):(l=u.getElementsByTagName("button")[0])&&(e.on(l,"click",function(){s(),a.focus()}),!1!==r.closeOnBlur&&e.on(l,"blur",s),l.focus()),s}),e.defineExtension("openConfirm",function(o,i,r){function s(){a||(a=!0,u.parentNode.removeChild(u),p.focus())}var c,l;t(this,null);var u=n(this,o,r&&r.bottom),f=u.getElementsByTagName("button"),a=!1,p=this,d=1;for(f[0].focus(),c=0;c<f.length;++c)l=f[c],function(n){e.on(l,"click",function(t){e.e_preventDefault(t),s(),n&&n(p)})}(i[c]),e.on(l,"blur",function(){--d,setTimeout(function(){d<=0&&s()},200)}),e.on(l,"focus",function(){++d})}),e.defineExtension("openNotification",function(o,i){function r(){l||(l=!0,clearTimeout(s),c.parentNode.removeChild(c))}t(this,r);var s,c=n(this,o,i&&i.bottom),l=!1,u=i&&"undefined"!=typeof i.duration?i.duration:5e3;return e.on(c,"click",function(n){e.e_preventDefault(n),r()}),u&&(s=setTimeout(r,u)),r})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],e):e(CodeMirror)}(function(e){"use strict";function n(e,n){return"string"==typeof e?e=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n?"gi":"g"):e.global||(e=new RegExp(e.source,e.ignoreCase?"gi":"g")),{token:function(n){e.lastIndex=n.pos;var t=e.exec(n.string);if(t&&t.index==n.pos)return n.pos+=t[0].length||1,"searching";t?n.pos=t.index:n.skipToEnd()}}}function t(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}function o(e){return e.state.search||(e.state.search=new t)}function i(e){return"string"==typeof e&&e==e.toLowerCase()}function r(e,n,t){return e.getSearchCursor(n,t,i(n))}function s(e,n,t,o,i){e.openDialog(n,o,{value:t,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){h(e)},onKeyDown:i})}function c(e,n,t,o,i){e.openDialog?e.openDialog(n,i,{value:o,selectValueOnOpen:!0}):i(prompt(t,o))}function l(e,n,t,o){e.openConfirm?e.openConfirm(n,o):confirm(t)&&o[0]()}function u(e){return e.replace(/\\(.)/g,function(e,n){return"n"==n?"\n":"r"==n?"\r":n})}function f(e){var n=e.match(/^\/(.*)\/([a-z]*)$/);if(n)try{e=new RegExp(n[1],-1==n[2].indexOf("i")?"":"i")}catch(e){}else e=u(e);return("string"==typeof e?""==e:e.test(""))&&(e=/x^/),e}function a(e,t,o){t.queryText=o,t.query=f(o),e.removeOverlay(t.overlay,i(t.query)),t.overlay=n(t.query,i(t.query)),e.addOverlay(t.overlay),e.showMatchesOnScrollbar&&(t.annotate&&(t.annotate.clear(),t.annotate=null),t.annotate=e.showMatchesOnScrollbar(t.query,i(t.query)))}function p(n,t,i,r){var l,u,f,p=o(n);if(p.query)return d(n,t);l=n.getSelection()||p.lastQuery,i&&n.openDialog?(u=null,f=function(t,o){e.e_stop(o),t&&(t!=p.queryText&&(a(n,p,t),p.posFrom=p.posTo=n.getCursor()),u&&(u.style.opacity=1),d(n,o.shiftKey,function(e,t){var o;t.line<3&&document.querySelector&&(o=n.display.wrapper.querySelector(".CodeMirror-dialog"))&&o.getBoundingClientRect().bottom-4>n.cursorCoords(t,"window").top&&((u=o).style.opacity=.4)}))},s(n,y,l,f,function(t,i){var r=e.keyName(t),s=e.keyMap[n.getOption("keyMap")][r];s||(s=n.getOption("extraKeys")[r]),"findNext"==s||"findPrev"==s||"findPersistentNext"==s||"findPersistentPrev"==s?(e.e_stop(t),a(n,o(n),i),n.execCommand(s)):("find"==s||"findPersistent"==s)&&(e.e_stop(t),f(i,t))}),r&&l&&(a(n,p,l),d(n,t))):c(n,y,"Search for:",l,function(e){e&&!p.query&&n.operation(function(){a(n,p,e),p.posFrom=p.posTo=n.getCursor(),d(n,t)})})}function d(n,t,i){n.operation(function(){var s=o(n),c=r(n,s.query,t?s.posFrom:s.posTo);(c.find(t)||(c=r(n,s.query,t?e.Pos(n.lastLine()):e.Pos(n.firstLine(),0)),c.find(t)))&&(n.setSelection(c.from(),c.to()),n.scrollIntoView({from:c.from(),to:c.to()},20),s.posFrom=c.from(),s.posTo=c.to(),i&&i(c.from(),c.to()))})}function h(e){e.operation(function(){var n=o(e);n.lastQuery=n.query,n.query&&(n.query=n.queryText=null,e.removeOverlay(n.overlay),n.annotate&&(n.annotate.clear(),n.annotate=null))})}function g(e,n,t){e.operation(function(){for(var o,i=r(e,n);i.findNext();)"string"!=typeof n?(o=e.getRange(i.from(),i.to()).match(n),i.replace(t.replace(/\$(\d)/g,function(e,n){return o[n]}))):i.replace(t)})}function m(e,n){if(!e.getOption("readOnly")){var t=e.getSelection()||o(e).lastQuery,i=n?"Replace all:":"Replace:";c(e,i+v,i,t,function(t){t&&(t=f(t),c(e,x,"Replace with:","",function(o){if(o=u(o),n)g(e,t,o);else{h(e);var i=r(e,t,e.getCursor("from")),s=function(){var n,u=i.from();((n=i.findNext())||(i=r(e,t),(n=i.findNext())&&(!u||i.from().line!=u.line||i.from().ch!=u.ch)))&&(e.setSelection(i.from(),i.to()),e.scrollIntoView({from:i.from(),to:i.to()}),l(e,C,"Replace?",[function(){c(n)},s,function(){g(e,t,o)}]))},c=function(e){i.replace("string"==typeof t?o:o.replace(/\$(\d)/g,function(n,t){return e[t]})),s()};s()}}))})}}var y='Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',v=' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',x='With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>',C="Replace? <button>Yes</button> <button>No</button> <button>All</button> <button>Stop</button>";e.commands.find=function(e){h(e),p(e)},e.commands.findPersistent=function(e){h(e),p(e,!1,!0)},e.commands.findPersistentNext=function(e){p(e,!1,!0,!0)},e.commands.findPersistentPrev=function(e){p(e,!0,!0,!0)},e.commands.findNext=p,e.commands.findPrev=function(e){p(e,!0)},e.commands.clearSearch=h,e.commands.replace=m,e.commands.replaceAll=function(e){m(e,!0)}}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function n(e,n,i,r){var s,c,l,u;this.atOccurrence=!1,this.doc=e,null==r&&"string"==typeof n&&(r=!1),i=i?e.clipPos(i):o(0,0),this.pos={from:i,to:i},"string"!=typeof n?(n.global||(n=new RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(t,i){var r,s,c,l,u,f;if(t){for(n.lastIndex=0,r=e.getLine(i.line).slice(0,i.ch),s=0;(n.lastIndex=s,u=n.exec(r))&&(c=u,l=c.index,(s=c.index+(c[0].length||1))!=r.length););f=c&&c[0].length||0,f||(0==l&&0==r.length?c=undefined:l!=e.getLine(i.line).length&&f++)}else{n.lastIndex=i.ch;var r=e.getLine(i.line),c=n.exec(r),f=c&&c[0].length||0,l=c&&c.index;l+f==r.length||f||(f=1)}if(c&&f)return{from:o(i.line,l),to:o(i.line,l+f),match:c}}):(s=n,r&&(n=n.toLowerCase()),c=r?function(e){return e.toLowerCase()}:function(e){return e},l=n.split("\n"),1==l.length?this.matches=n.length?function(i,r){if(i){var l=e.getLine(r.line).slice(0,r.ch),u=c(l),f=u.lastIndexOf(n);if(f>-1)return f=t(l,u,f),{from:o(r.line,f),to:o(r.line,f+s.length)}}else{var l=e.getLine(r.line).slice(r.ch),u=c(l),f=u.indexOf(n);if(f>-1)return f=t(l,u,f)+r.ch,{from:o(r.line,f),to:o(r.line,f+s.length)}}}:function(){}:(u=s.split("\n"),this.matches=function(n,t){var i,r,s,f,a,p,d=l.length-1;if(n){if(t.line-(l.length-1)<e.firstLine())return;if(c(e.getLine(t.line).slice(0,u[d].length))!=l[l.length-1])return;for(i=o(t.line,u[d].length),a=t.line-1,p=d-1;p>=1;--p,--a)if(l[p]!=c(e.getLine(a)))return;return r=e.getLine(a),s=r.length-u[0].length,c(r.slice(s))!=l[0]?void 0:{from:o(a,s),to:i}}if(!(t.line+(l.length-1)>e.lastLine())&&(r=e.getLine(t.line),s=r.length-u[0].length,c(r.slice(s))==l[0])){for(f=o(t.line,s),a=t.line+1,p=1;p<d;++p,++a)if(l[p]!=c(e.getLine(a)))return;if(c(e.getLine(a).slice(0,u[d].length))==l[d])return{from:f,to:o(a,u[d].length)}}}))}function t(e,n,t){var o,i;if(e.length==n.length)return t;for(o=Math.min(t,e.length);;)if((i=e.slice(0,o).toLowerCase().length)<t)++o;else{if(!(i>t))return o;--o}}var o=e.Pos;n.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function n(e){var n=o(e,0);return i.pos={from:n,to:n},i.atOccurrence=!1,!1}for(var t,i=this,r=this.doc.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,r))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!r.line)return n(0);r=o(r.line-1,this.doc.getLine(r.line-1).length)}else{if(t=this.doc.lineCount(),r.line==t-1)return n(t);r=o(r.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n,t){if(this.atOccurrence){var i=e.splitLines(n);this.doc.replaceRange(i,this.pos.from,this.pos.to,t),this.pos.to=o(this.pos.from.line+i.length-1,i[i.length-1].length+(1==i.length?this.pos.from.ch:0))}}},e.defineExtension("getSearchCursor",function(e,t,o){return new n(this.doc,e,t,o)}),e.defineDocExtension("getSearchCursor",function(e,t,o){return new n(this,e,t,o)}),e.defineExtension("selectMatches",function(n,t){for(var o=[],i=this.getSearchCursor(n,this.getCursor("from"),t);i.findNext()&&!(e.cmpPos(i.to(),this.getCursor("to"))>0);)o.push({anchor:i.from(),head:i.to()});o.length&&this.setSelections(o,0)})});